"use strict";function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function each(e,r){for(var t=0;t<e.length;t++)r(e[t],t)}function createFragment(t){if(t.indexOf("<!doctype")>=0)return[(new DOMParser).parseFromString(t,"text/html").childNodes[1]];var e=document.createElement("div");return e.insertAdjacentHTML("beforeend",t),e.childNodes}function createVirtual(e){var t=[];return each(e,function(e){if(3===e.nodeType)t.push(e.nodeValue);else if(1===e.nodeType){var r={};each(e.attributes,function(t){r[t.name]=t.value}),t.push({tag:e.nodeName.toLowerCase(),attrs:r,children:createVirtual(e.childNodes)})}}),t}function TemplateBuilder(t,e){this.virtual=t,this.level=e,this.virtuals=[],this.indented=!1}Object.defineProperty(exports,"__esModule",{value:!0});var _mithril=require("mithril"),_mithril2=_interopRequireDefault(_mithril),_button=require("polythene/button/button"),_button2=_interopRequireDefault(_button),_textfield=require("polythene/textfield/textfield"),_textfield2=_interopRequireDefault(_textfield);TemplateBuilder.prototype={addVirtualString:function(t){/\t| {2,}/.test(t)&&/^\s*/.test(t)?this.indented=!0:this.virtuals.push('"'+t.replace(/(["\r\n])/g,"\\$1")+'"')},addVirtualAttrs:function(t){var e="div"===t.tag?"":t.tag;if(t.attrs.class&&(e+="."+t.attrs.class.replace(/\s+/g,"."),t.attrs.class=void 0),each(Object.keys(t.attrs).sort(),function(r){"style"!==r&&void 0!==t.attrs[r]&&(e+="["+r+"='",e+=t.attrs[r].replace(/'/g,"\\'")+"']")}),""===e&&(e="div"),e='"'+e+'"',t.attrs.style){var r='{"'+t.attrs.style.replace(/:/g,'": "').replace(/;/g,'", "')+"}";e+=", {style: "+r.replace(/(, )"}/,"}")+"}"}if(0!==t.children.length){var i=new TemplateBuilder(t.children,this.level+1);e+=", "+i.complete()}this.virtuals.push("m("+e+")")},complete:function(){for(var t="\n",e=0;e<=this.level;e++)t+="	";if(each(this.virtual,function(t){"string"==typeof t?this.addVirtualString(t):this.addVirtualAttrs(t)}.bind(this)),this.indented||(t=""),1===this.virtuals.length&&'"'===this.virtuals[0][0])return this.virtuals.join(", ");var r=this.virtuals.join(","+t);return"["+t+r+t.slice(0,-1)+"]"}};var converter={controller:function(){this.source=_mithril2.default.prop(""),this.output=_mithril2.default.prop(""),this.convert=function(){var t=createVirtual(createFragment(this.source()));return this.output(new TemplateBuilder(t,1).complete())}.bind(this)},view:function(t){return(0,_mithril2.default)("div",[_mithril2.default.component(_textfield2.default,{class:"source",autofocus:!0,label:"Paste source HTML",getState:function(e){var r=!(!t.source()&&!e.value);t.source(e.value),r&&t.convert()},multiline:!0,rows:8,value:t.source()}),_mithril2.default.component(_textfield2.default,{class:"result",multiline:!0,readonly:!0,label:"Copy result from here",rows:8,value:function(){return t.output()}})])}};exports.default=converter;