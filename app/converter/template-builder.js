"use strict";function each(t,n){for(var e=0;e<t.length;e++)n(t[e],e)}function createFragment(e){if(e=e.replace(/&/g,"&amp;"),e.indexOf("<!doctype")>=0)return[(new DOMParser).parseFromString(e,"text/html").childNodes[1]];var t=document.createElement("div");return t.insertAdjacentHTML("beforeend",e),t.childNodes}function createVirtual(t){var e=[];return each(t,function(t){3===t.nodeType?e.push(t.nodeValue):1===t.nodeType&&!function(){var r={};each(t.attributes,function(e){r[e.name]=e.value});var n=t.nodeName.toLowerCase(),i=svgCaseSensitiveTagNamesMap[n]?svgCaseSensitiveTagNamesMap[n]:n;e.push({tag:i,attrs:r,children:createVirtual(t.childNodes)})}()}),e}function TemplateBuilder(e){this.virtual=e,this.children=[]}var ENTITY_REGEX=/(\&#?\w+;)/,svgCaseSensitiveTagNames=["altGlyph","altGlyphDef","altGlyphItem","animateColor","animateMotion","animateTransform","clipPath","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","foreignObject","glyphRef","linearGradient","radialGradient","textPath"],svgCaseSensitiveTagNamesMap={};svgCaseSensitiveTagNames.forEach(function(e){svgCaseSensitiveTagNamesMap[e.toLowerCase()]=e}),TemplateBuilder.prototype={addVirtualString:function(r){var e=this,t=r.replace(/(["\r\n])/g,"\\$1"),n=t.split(ENTITY_REGEX);n.length>1?n.forEach(function(t){t.match(ENTITY_REGEX)?e.children.push({content:'m.trust("'+t+'")'}):t&&e.children.push({content:'"'+t+'"'})}):this.children.push({content:'"'+t+'"'})},addVirtualAttrs:function(e){var n="div"===e.tag?"":e.tag;if(e.attrs.class){var t=e.attrs.class.replace(/\s+/g,".");n+="."+t,e.attrs.class=void 0}if(each(Object.keys(e.attrs).sort(),function(r){if("style"!==r&&void 0!==e.attrs[r]){var t=e.attrs[r];t=t.replace(/[\n\r\t]/g," "),t=t.replace(/\s+/g," "),t=t.replace(/'/g,"\\'"),n+="["+r+"='"+t+"']"}}),""===n&&(n="div"),n='"'+n+'"',e.attrs.style){var t=e.attrs.style.replace(/(^.*);\s*$/,"$1");t=t.replace(/[\n\r]/g,""),t=t.split(/\s*;\s*/),t=t.map(function(e){return e.split(/\s*:\s*/).map(function(e){return'"'+e+'"'}).join(": ")}),t=t.join(", "),n+=", {style: {"+t+"}}"}var r=0!==e.children.length?new TemplateBuilder(e.children).complete():null;this.children.push({node:n,children:r})},complete:function(){return each(this.virtual,function(e){"string"==typeof e?!/(^\s*$)|(^\"$)/.test(e)&&e.charCodeAt()>=32&&this.addVirtualString(e):this.addVirtualAttrs(e)}.bind(this)),this.children}};var whitespace=function e(t,r){if(0>t)return"";for(var e="",n=0;t>n;n++)e+=r;return e},wrapperTemplate=function(e){return"["+e+"\n]"},contentTemplate=function(e,t){return"\n"+t+e},singleMithrilNodeTemplate=function(e,n,t){return"\n"+t+"m("+e+")"},mithrilNodeMultipleChildrenTemplate=function(n,r,e,t){return"\n"+e+"m("+n+",\n"+e+t+"["+r+"\n"+e+t+"]\n"+e+")"},mithrilNodeSingleChildTemplate=function(t,n,e){return"\n"+e+"m("+t+", "+n+"\n"+e+")"},template=function(t,e,n,r){return e?e.length>1?mithrilNodeMultipleChildrenTemplate(t,e,n,r):mithrilNodeSingleChildTemplate(t,e,n,r):singleMithrilNodeTemplate(t,e,n,r)},formatCode=function r(t,n,e){return t?t.map(function(t){var i=whitespace(n,e);if(t.content)return contentTemplate(t.content,i);var a=t.node||"",l=n+(t.children&&t.children.length>1?2:1),o=r(t.children,l,e)||"";return template(a,o,i,e)}):""},indentCharsMap={2:"  ",4:"    ",tab:"	"},templateBuilder=function(t){var r=createVirtual(createFragment(t.source)),n=new TemplateBuilder(r).complete(),i=n.length>1?1:0,a=indentCharsMap[t.indent||"4"],e=formatCode(n,i,a),l=e.length>1?wrapperTemplate(e.join(", ")):e.join("").trim();return l};"undefined"!=typeof module&&null!==module&&module.exports?module.exports=templateBuilder:"function"==typeof define&&define.amd&&define(function(){return templateBuilder});