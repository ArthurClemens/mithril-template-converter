!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).mithrilTemplateBuilder=e.mithrilTemplateBuilder||{})}(this,(function(e){"use strict";function t(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function n(e){for(var n=1;n<arguments.length;n++){var a=null!=arguments[n]?arguments[n]:{};n%2?t(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):t(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function o(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,a,o=[],i=!0,c=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(e){c=!0,a=e}finally{try{i||null==n.return||n.return()}finally{if(c)throw a}}return o}(e,t)||c(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e){return function(e){if(Array.isArray(e))return l(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||c(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(e,t){if(e){if("string"==typeof e)return l(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?l(e,t):void 0}}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var u={allowfullscreen:1,allowpaymentrequest:1,async:1,autofocus:1,autoplay:1,checked:1,controls:1,default:1,defer:1,disabled:1,formnovalidate:1,hidden:1,ismap:1,itemscope:1,loop:1,multiple:1,muted:1,nomodule:1,novalidate:1,open:1,readonly:1,required:1,reversed:1,selected:1,typemustmatch:1},s={altglyph:"altGlyph",altglyphdef:"altGlyphDef",altglyphitem:"altGlyphItem",animatecolor:"animateColor",animatemotion:"animateMotion",animatetransform:"animateTransform",clippath:"clipPath",feblend:"feBlend",fecolormatrix:"feColorMatrix",fecomponenttransfer:"feComponentTransfer",fecomposite:"feComposite",feconvolvematrix:"feConvolveMatrix",fediffuselighting:"feDiffuseLighting",fedisplacementmap:"feDisplacementMap",fedistantlight:"feDistantLight",feflood:"feFlood",fefunca:"feFuncA",fefuncb:"feFuncB",fefuncg:"feFuncG",fefuncr:"feFuncR",fegaussianblur:"feGaussianBlur",feimage:"feImage",femerge:"feMerge",femergenode:"feMergeNode",femorphology:"feMorphology",feoffset:"feOffset",fepointlight:"fePointLight",fespecularlighting:"feSpecularLighting",fespotlight:"feSpotLight",fetile:"feTile",feturbulence:"feTurbulence",foreignobject:"foreignObject",glyphref:"glyphRef",lineargradient:"linearGradient",radialgradient:"radialGradient",textpath:"textPath"},f=["class","style"],h=/(&#?\w+;)/,d=/^[a-zA-Z][a-zA-Z0-9\-:]*$/,p={2:{label:"2 spaces",value:"  "},4:{label:"4 spaces",value:"    "},tab:{label:"Tabs",value:"\t"}},g=p[2],m={attributes:{label:"Attributes",value:"attributes"},selectors:{label:"Selectors",value:"selectors"}},y=m.attributes,b={double:{label:"Double",value:'"'},single:{label:"Single",value:"'"}},v=b.double,O=function(e,t){return e.replace(new RegExp('"',"g"),t)},j=function(e,t){for(var n=0;n<e.length;n++)t(e[n],n)},C=function e(t){var n=[];return j(t,(function(t){if(3===t.nodeType)n.push(t.nodeValue);else if(1===t.nodeType){var r={};j(t.attributes,(function(e){var t=e.name,n=e.value;!!t.match(d)&&(r[t]=u[t]?t:n)}));var a=t.nodeName.toLowerCase();if(!!a.match(d)){var o=s[a]||a;n.push({tag:o,attrs:r,children:e(t.childNodes)})}}})),n},S=function(e){var t=e.replace(/(^.*);\s*$/,"$1");return(t=t.replace(/[\n\r]/g,"")).split(/\s*;\s*/).map((function(e){return e.split(/\s*:\s*/)}))},q=function(e){return e.reduce((function(e,t){var n=o(t,2),r=n[0],a=n[1];return e[r]=a,e}),{})};function w(e,t){var n=t.attrs,r=t.tags,a=t.quoteChar;this.virtual=e,this.attrs=n,this.tags=r,this.quoteChar=a,this.embeddedQuoteChar='"'===a?"'":'"',this.children=[]}w.prototype={addVirtualString:function(e){var t=this,n=e.replace(/(["\r\n])/g,"\\$1"),r=n.split(h);r.length>1?r.forEach((function(e){e.match(h)?t.children.push({content:"m.trust(".concat(t.quoteChar).concat(e).concat(t.quoteChar,")")}):e&&t.children.push({content:"".concat(t.quoteChar).concat(e).concat(t.quoteChar)})})):this.children.push({content:"".concat(this.quoteChar).concat(n).concat(this.quoteChar)}),this.tags.pop()},addVnode:function(e){var t=this,r={tag:"",className:"",attrsAsSelectorString:"",attrsAsObjectString:"",style:""},o=e.attrs,c=o.class,l=void 0===c?"":c,s=o.style,h=void 0===s?"":s,d=a(o,f),p=Object.keys(d).filter((function(e){return void 0!==d[e]})).reduce((function(e,t){return e[t]=d[t],e}),{});if(this.attrs===m.selectors.value){if(r.tag="div"===e.tag?0===Object.keys(p).length?"div":"":e.tag,r.className=l?".".concat(l.replace(/\s+/g,".")):"",r.attrsAsSelectorString=Object.keys(p).map((function(e){var n=p[e].replace(/[\n\r\t]/g," ").replace(/\s+/g," ").replace(new RegExp(t.embeddedQuoteChar,"g"),t.quoteChar);return u[e]&&e===n?"[".concat(e,"]"):"[".concat(e,"=").concat(t.embeddedQuoteChar).concat(n).concat(t.embeddedQuoteChar,"]")})).join(""),h){var g=S(h),y=q(g),b=O(JSON.stringify(y),this.quoteChar);r.style=", {".concat(this.quoteChar,"style").concat(this.quoteChar,":").concat(b,"}")}}else{var v=h?q(S(h)):{},j=n(n(n({},l.length>0?{class:O(l,this.quoteChar)}:{}),p),Object.keys(v).length>0?{style:v}:{});r.tag=e.tag||"div",Object.keys(j).length>0&&(r.attrsAsObjectString=", ".concat(O(JSON.stringify(j),this.quoteChar)))}e.children=e.children.map((function(e){if("string"==typeof e){var n="pre"===r.tag||void 0!==t.tags.find((function(e){return"pre"===e})),a=e.trim().split(/[\n\r]/g);if(n&&a.length>1)return{tag:"div",attrs:{},children:a.map((function(e){return{tag:"div",attrs:{},children:[e]}}))}}return e}));var C=0!==e.children.length?new w(e.children,{attrs:this.attrs,tags:[].concat(i(this.tags),[e.tag]),quoteChar:this.quoteChar}).complete():null;this.children.push({node:function(e){var n=e.tag,r=e.className,a=e.attrsAsSelectorString,o=e.attrsAsObjectString,i=e.style;return"".concat(t.quoteChar).concat(n).concat(r).concat(a).concat(t.quoteChar).concat(o).concat(i)}(r),children:C})},complete:function(){return j(this.virtual,function(e){if("string"==typeof e){var t=e.trim(),n=e.charCodeAt(0);if(0!==t.length&&'"'!==t&&(1!==t.length||10!==n)&&(10===n||n>=32)){var r=e.replace(/[\n\r\t]/g," ").replace(/\s+/g," ");this.addVirtualString(r)}}else this.addVnode(e)}.bind(this)),this.children}};var A=function e(t,n,r){if(t)return t.map((function(t){var a=function(e,t){if(e<0)return"";for(var n="",r=0;r<e;r++)n+=t;return n}(n,r);if(t.content)return function(e,t){return"\n".concat(t).concat(e)}(t.content,a);var o=t.node||"",i=n+(t.children&&t.children.length>1?2:1);return function(e,t,n,r){return t?t.length>1?function(e,t,n,r){return"\n".concat(n,"m(").concat(e,",\n").concat(n).concat(r,"[").concat(t,"\n").concat(n).concat(r,"]\n").concat(n,")")}(e,t,n,r):function(e,t,n){return"\n".concat(n,"m(").concat(e,", ").concat(t,"\n").concat(n,")")}(e,t,n):function(e,t){return"\n".concat(t,"m(").concat(e,")")}(e,n)}(o,e(t.children,i,r),a,r)}))};e.attrsOptions=m,e.indentOptions=p,e.quotesOptions=b,e.templateBuilder=function(e){var t,n=function(e){if((e=e.replace(/&/g,"&amp;")).indexOf("<!doctype")>=0)return[(new DOMParser).parseFromString(e,"text/html").childNodes[1]];var t=document.createElement("div");return t.insertAdjacentHTML("beforeend",e),i(t.childNodes)}(e.source),r=new w(C(n),{attrs:m[e.attrs]?m[e.attrs].value:y.value,quoteChar:b[e.quotes]?b[e.quotes].value:v.value,tags:[]}).complete(),a=r.length>1?1:0,o=p[e.indent]?p[e.indent].value:g.value,c=A(r,a,o);return c.length>1?(t=c.join(", "),"[".concat(t,"\n]")):c.join("").trim()},Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=mithril-template-builder.js.map
