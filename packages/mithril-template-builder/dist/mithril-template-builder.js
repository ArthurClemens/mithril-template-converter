!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).mithrilTemplateBuilder=e.mithrilTemplateBuilder||{})}(this,function(e){"use strict";function t(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function n(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function r(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,a=!1,o=void 0;try{for(var c,i=e[Symbol.iterator]();!(r=(c=i.next()).done)&&(n.push(c.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{r||null==i.return||i.return()}finally{if(a)throw o}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function a(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var o={allowfullscreen:1,allowpaymentrequest:1,async:1,autofocus:1,autoplay:1,checked:1,controls:1,default:1,defer:1,disabled:1,formnovalidate:1,hidden:1,ismap:1,itemscope:1,loop:1,multiple:1,muted:1,nomodule:1,novalidate:1,open:1,readonly:1,required:1,reversed:1,selected:1,typemustmatch:1},c={altglyph:"altGlyph",altglyphdef:"altGlyphDef",altglyphitem:"altGlyphItem",animatecolor:"animateColor",animatemotion:"animateMotion",animatetransform:"animateTransform",clippath:"clipPath",feblend:"feBlend",fecolormatrix:"feColorMatrix",fecomponenttransfer:"feComponentTransfer",fecomposite:"feComposite",feconvolvematrix:"feConvolveMatrix",fediffuselighting:"feDiffuseLighting",fedisplacementmap:"feDisplacementMap",fedistantlight:"feDistantLight",feflood:"feFlood",fefunca:"feFuncA",fefuncb:"feFuncB",fefuncg:"feFuncG",fefuncr:"feFuncR",fegaussianblur:"feGaussianBlur",feimage:"feImage",femerge:"feMerge",femergenode:"feMergeNode",femorphology:"feMorphology",feoffset:"feOffset",fepointlight:"fePointLight",fespecularlighting:"feSpecularLighting",fespotlight:"feSpotLight",fetile:"feTile",feturbulence:"feTurbulence",foreignobject:"foreignObject",glyphref:"glyphRef",lineargradient:"linearGradient",radialgradient:"radialGradient",textpath:"textPath"},i=/(&#?\w+;)/,l=/^[a-zA-Z][a-zA-Z0-9\-\:]*$/,u={2:{label:"2 spaces",value:"  "},4:{label:"4 spaces",value:"    "},tab:{label:"Tabs",value:"\t"}},s=u[2],f={attributes:{label:"Attributes",value:"attributes"},selectors:{label:"Selectors",value:"selectors"}},h=f.attributes,d={double:{label:"Double",value:'"'},single:{label:"Single",value:"'"}},p=d.double,g=function(e,t){return e.replace(new RegExp('"',"g"),t)},m=function(e,t){for(var n=0;n<e.length;n++)t(e[n],n)},v=function(e){var t=e.replace(/(^.*);\s*$/,"$1");return(t=t.replace(/[\n\r]/g,"")).split(/\s*;\s*/).map(function(e){return e.split(/\s*:\s*/)})},y=function(e){return e.reduce(function(e,t){var n=r(t,2),a=n[0],o=n[1];return e[a]=o,e},{})};function b(e,t){var n=t.attrs,r=t.quoteChar;this.virtual=e,this.attrs=n,this.quoteChar=r,this.embeddedQuoteChar='"'===r?"'":'"',this.children=[]}b.prototype={addVirtualString:function(e){var t=this,n=e.replace(/(["\r\n])/g,"\\$1"),r=n.split(i);r.length>1?r.forEach(function(e){e.match(i)?t.children.push({content:"m.trust(".concat(t.quoteChar).concat(e).concat(t.quoteChar,")")}):e&&t.children.push({content:"".concat(t.quoteChar).concat(e).concat(t.quoteChar)})}):this.children.push({content:"".concat(this.quoteChar).concat(n).concat(this.quoteChar)})},addVirtualAttrs:function(e){var r=this,a={tag:"",className:"",attrsAsSelectorString:"",attrsAsObjectString:"",style:""},c=e.attrs,i=c.class,l=void 0===i?"":i,u=c.style,s=void 0===u?"":u,h=n(c,["class","style"]),d=Object.keys(h).filter(function(e){return void 0!==h[e]}).reduce(function(e,t){return e[t]=h[t],e},{});if(this.attrs===f.selectors.value){if(a.tag="div"===e.tag?0===Object.keys(d).length?"div":"":e.tag,a.className=l?".".concat(l.replace(/\s+/g,".")):"",a.attrsAsSelectorString=Object.keys(d).map(function(e){var t=d[e].replace(/[\n\r\t]/g," ").replace(/\s+/g," ").replace(new RegExp(r.embeddedQuoteChar,"g"),r.quoteChar);return o[e]&&e===t?"[".concat(e,"]"):"[".concat(e,"=").concat(r.embeddedQuoteChar).concat(t).concat(r.embeddedQuoteChar,"]")}).join(""),s){var p=v(s),m=y(p),O=g(JSON.stringify(m),this.quoteChar);a.style=", {".concat(this.quoteChar,"style").concat(this.quoteChar,":").concat(O,"}")}}else{var C=s?y(v(s)):{},j=function(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{},a=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),a.forEach(function(n){t(e,n,r[n])})}return e}({},l.length>0?{class:g(l,this.quoteChar)}:{},d,Object.keys(C).length>0?{style:C}:{});a.tag=e.tag||"div",Object.keys(j).length>0&&(a.attrsAsObjectString=", ".concat(g(JSON.stringify(j),this.quoteChar)))}var S=0!==e.children.length?new b(e.children,{attrs:this.attrs,quoteChar:this.quoteChar}).complete():null;this.children.push({node:function(e){var t=e.tag,n=e.className,a=e.attrsAsSelectorString,o=e.attrsAsObjectString,c=e.style;return"".concat(r.quoteChar).concat(t).concat(n).concat(a).concat(r.quoteChar).concat(o).concat(c)}(a),children:S})},complete:function(){return m(this.virtual,function(e){if("string"==typeof e){var t=e.trim(),n=e.charCodeAt(0);if(0!==t.length&&'"'!==t&&(1!==t.length||10!==n)&&(10===n||n>=32)){var r=e.replace(/[\n\r\t]/g," ").replace(/\s+/g," ");this.addVirtualString(r)}}else this.addVirtualAttrs(e)}.bind(this)),this.children}};e.attrsOptions=f,e.indentOptions=u,e.quotesOptions=d,e.templateBuilder=function(e){var t,n=new b(function e(t){var n=[];return m(t,function(t){if(3===t.nodeType)n.push(t.nodeValue);else if(1===t.nodeType){var r={};m(t.attributes,function(e){var t=e.name,n=e.value;t.match(l)&&(r[t]=o[t]?t:n)});var a=t.nodeName.toLowerCase();if(a.match(l)){var i=c[a]||a;n.push({tag:i,attrs:r,children:e(t.childNodes)})}}}),n}(function(e){if((e=e.replace(/&/g,"&amp;")).indexOf("<!doctype")>=0)return[(new DOMParser).parseFromString(e,"text/html").childNodes[1]];var t=document.createElement("div");return t.insertAdjacentHTML("beforeend",e),a(t.childNodes)}(e.source)),{attrs:f[e.attrs]?f[e.attrs].value:h.value,quoteChar:d[e.quotes]?d[e.quotes].value:p.value}).complete(),r=function e(t,n,r){if(t)return t.map(function(t){var a=function(e,t){if(e<0)return"";for(var n="",r=0;r<e;r++)n+=t;return n}(n,r);if(t.content)return function(e,t){return"\n".concat(t).concat(e)}(t.content,a);var o=t.node||"",c=n+(t.children&&t.children.length>1?2:1);return function(e,t,n,r){return t?t.length>1?function(e,t,n,r){return"\n".concat(n,"m(").concat(e,",\n").concat(n).concat(r,"[").concat(t,"\n").concat(n).concat(r,"]\n").concat(n,")")}(e,t,n,r):function(e,t,n){return"\n".concat(n,"m(").concat(e,", ").concat(t,"\n").concat(n,")")}(e,t,n):function(e,t){return"\n".concat(t,"m(").concat(e,")")}(e,n)}(o,e(t.children,c,r),a,r)})}(n,n.length>1?1:0,u[e.indent]?u[e.indent].value:s.value);return r.length>1?(t=r.join(", "),"[".concat(t,"\n]")):r.join("").trim()},Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=mithril-template-builder.js.map
